# autManè‚šå­ç–¼è®°å½•æ’ä»¶å¼€å‘å®Œæˆ

## é¡¹ç›®æ¦‚è¿°

æˆåŠŸä¸ºautManå¹³å°å¼€å‘äº†ä¸€ä¸ªè‚šå­ç–¼æ—¶é—´è®°å½•æ’ä»¶,ç”¨äºè‡ªåŠ¨è®°å½•å’Œç»Ÿè®¡å­©å­è‚šå­ç–¼çš„æ—¶é—´ã€‚

## å¼€å‘è¿‡ç¨‹

### 1. é—®é¢˜è¯Šæ–­

**åˆå§‹é—®é¢˜**: ç”¨æˆ·æä¾›çš„ES5æ’ä»¶ä»£ç æ— æ³•å·¥ä½œ,å‘é€"è‚šå­ç–¼"æ²¡æœ‰ä»»ä½•å›å¤ã€‚

**é—®é¢˜æ ¹æº**:
- åŸå§‹ä»£ç ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å…¨å±€å‡½æ•°(`GetContent()`, `GetUserID()`ç­‰)
- è¿™äº›å‡½æ•°åœ¨autMançš„JavaScriptç¯å¢ƒä¸­ä¸å¯ç”¨

### 2. APIç ”ç©¶

é€šè¿‡ç ”ç©¶fanlié¡¹ç›®çš„[middleware.js](https://github.com/hdbjlizhe/fanli),å‘ç°autManä½¿ç”¨:
- Node.jså¼‚æ­¥API (async/await)
- Senderç±»å°è£…æ¶ˆæ¯å‘é€åŠŸèƒ½
- éœ€è¦é€šè¿‡`require('../middleware.js')`åŠ è½½

### 3. è·¯å¾„é—®é¢˜è¯Šæ–­

**å°è¯•çš„æ–¹æ¡ˆ**:
1. âŒ ç›¸å¯¹è·¯å¾„: `require('../scripts/middleware.js')`
2. âŒ ç»å¯¹è·¯å¾„: `require('/root/autman/plugin/scripts/middleware.js')`
3. âŒ ä¸å¸¦æ‰©å±•å: `require('../scripts/middleware')`

**å‘ç°**: æ‰€æœ‰requireæ–¹å¼éƒ½å¤±è´¥,æŠ¥é”™"no such file or directory"

### 4. å…¨å±€å¯¹è±¡æ£€æµ‹

åˆ›å»ºæµ‹è¯•æ’ä»¶å‘ç°autMançš„çœŸå®APIç»“æ„:

**å¯ç”¨çš„å…¨å±€å‡½æ•°**:
- `bucketGet(bucket, key)` - è¯»å–æ•°æ®
- `bucketSet(bucket, key, value)` - ä¿å­˜æ•°æ®
- `bucketDel(bucket, key)` - åˆ é™¤æ•°æ®
- `Sender` - æ¶ˆæ¯å‘é€å¯¹è±¡(ä½†ä¸æ˜¯æ„é€ å‡½æ•°)

**ä»thiså¯¹è±¡è·å–ä¸Šä¸‹æ–‡**:
```javascript
this.Sender.sender.message.text  // æ¶ˆæ¯å†…å®¹
this.Sender.sender.message.sender.iD  // ç”¨æˆ·ID
this.Sender.sender.message.sender.firstName  // ç”¨æˆ·å
```

### 5. æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

**å…³é”®å‘ç°**: autManå°†APIæ³¨å…¥åˆ°å…¨å±€ä½œç”¨åŸŸå’Œthiså¯¹è±¡ä¸­,ä¸éœ€è¦require!

**æˆåŠŸçš„ä»£ç ç»“æ„** ([è‚šå­ç–¼_v1.1.js](file:///Users/z.W./.gemini/antigravity/scratch/%E8%82%9A%E5%AD%90%E7%96%BC_v1.1.js)):

```javascript
// 1. ç›´æ¥ä½¿ç”¨å…¨å±€å‡½æ•°
await bucketGet(BUCKET_NAME, STORAGE_KEY);
await bucketSet(BUCKET_NAME, STORAGE_KEY, data);

// 2. ä»thiså¯¹è±¡è·å–ä¸Šä¸‹æ–‡
function getMessageContent() {
    return this.Sender.sender.baseSender.content || "";
}

function getUserID() {
    return this.Sender.sender.message.sender.iD;
}

// 3. å‘é€æ¶ˆæ¯
async function sendMessage(text) {
    if (Sender && typeof Sender.reply === 'function') {
        return Sender.reply(text);
    }
}
```

## æ’ä»¶åŠŸèƒ½

### âœ… æ ¸å¿ƒåŠŸèƒ½

1. **è‡ªåŠ¨è®°å½•** - å‘é€"è‚šå­ç–¼"è‡ªåŠ¨è®°å½•æ—¶é—´å’Œæ—¶é—´æˆ³
2. **å†å²æŸ¥è¯¢** - å‘é€"è‚šå­ç–¼è®°å½•"æŸ¥çœ‹æ‰€æœ‰è®°å½•(æœ€æ–°åœ¨å‰)
3. **æ•°æ®ç»Ÿè®¡** - è‡ªåŠ¨è®¡ç®—é¦–æ¬¡/æœ€è¿‘è®°å½•ã€è®°å½•å¤©æ•°ã€å¹³å‡é¢‘ç‡
4. **æ¸…ç©ºè®°å½•** - å‘é€"æ¸…ç©ºè‚šå­ç–¼è®°å½•"åˆ é™¤æ‰€æœ‰æ•°æ®
5. **å¸®åŠ©ä¿¡æ¯** - å‘é€"è‚šå­ç–¼å¸®åŠ©"æ˜¾ç¤ºä½¿ç”¨è¯´æ˜

### ğŸ“Š æ•°æ®å­˜å‚¨

- **å­˜å‚¨æ¡¶**: `stomach_pain`
- **å­˜å‚¨é”®**: `user_{ç”¨æˆ·ID}`
- **æ•°æ®æ ¼å¼**: JSONæ•°ç»„,æ¯æ¡è®°å½•åŒ…å«æ—¶é—´å­—ç¬¦ä¸²å’Œæ—¶é—´æˆ³

```json
[
  {
    "time": "2026-01-02 12:00:00",
    "timestamp": 1735790400000
  }
]
```

## æŠ€æœ¯è¦ç‚¹

### autMan JavaScriptæ’ä»¶å¼€å‘è§„èŒƒ

1. **ä¸éœ€è¦require** - æ‰€æœ‰APIéƒ½æ˜¯å…¨å±€æ³¨å…¥çš„
2. **ä½¿ç”¨async/await** - æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„
3. **ä»thisè·å–ä¸Šä¸‹æ–‡** - æ¶ˆæ¯ã€ç”¨æˆ·ä¿¡æ¯éƒ½åœ¨`this.Sender`ä¸­
4. **å…¨å±€å‡½æ•°å¯ç”¨**: `bucketGet`, `bucketSet`, `bucketDel`ç­‰

### æ–‡ä»¶é…ç½®

æ’ä»¶æ–‡ä»¶å¤´éƒ¨å¿…é¡»åŒ…å«é…ç½®æ³¨é‡Š:

```javascript
// [disable:false]          // å¯ç”¨æ’ä»¶
// [rule: ^è‚šå­ç–¼(.*)$]      // æ­£åˆ™åŒ¹é…è§„åˆ™
// [admin: false]           // ä¸éœ€è¦ç®¡ç†å‘˜æƒé™
// [service: 88489948]      // æœåŠ¡å·
// [price: 0.00]            // ä»·æ ¼(å…è´¹)
// [version: 2026.01.02]    // ç‰ˆæœ¬å·
```

## éƒ¨ç½²æ­¥éª¤

1. **ä¸Šä¼ æ’ä»¶æ–‡ä»¶**
   ```bash
   scp è‚šå­ç–¼_v1.1.js root@æœåŠ¡å™¨:/root/autman/plugin/replies/è‚šå­ç–¼.js
   ```

2. **é‡å¯autMan**
   ```bash
   cd /root/autman
   pm2 restart autman  # æˆ–å…¶ä»–é‡å¯å‘½ä»¤
   ```

3. **æµ‹è¯•åŠŸèƒ½**
   - å‘é€: `è‚šå­ç–¼` â†’ è®°å½•æ—¶é—´
   - å‘é€: `è‚šå­ç–¼è®°å½•` â†’ æŸ¥çœ‹å†å²
   - å‘é€: `è‚šå­ç–¼å¸®åŠ©` â†’ æ˜¾ç¤ºå¸®åŠ©

## ç»éªŒæ€»ç»“

### å…³é”®æ•™è®­

1. **ä¸è¦ç›²ç›®å‚è€ƒå®˜æ–¹ç¤ºä¾‹** - fanlié¡¹ç›®çš„middleware.jsæ–¹å¼åœ¨å®é™…éƒ¨ç½²ä¸­ä¸é€‚ç”¨
2. **é€šè¿‡æµ‹è¯•æ’ä»¶æ¢ç´¢çœŸå®API** - åˆ›å»ºæ£€æµ‹æ’ä»¶æ¯”çŒœæµ‹æ›´é«˜æ•ˆ
3. **æ£€æŸ¥thiså¯¹è±¡** - å¾ˆå¤šæ¡†æ¶ä¼šé€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡ä¼ é€’ä¿¡æ¯
4. **å…¨å±€æ³¨å…¥æ˜¯å¸¸è§æ¨¡å¼** - æ’ä»¶ç³»ç»Ÿç»å¸¸ä½¿ç”¨å…¨å±€æ³¨å…¥è€Œéæ¨¡å—ç³»ç»Ÿ

### è°ƒè¯•æŠ€å·§

åˆ›å»ºç®€å•çš„æµ‹è¯•æ’ä»¶æ¥æ¢ç´¢API:
```javascript
// æ£€æµ‹å…¨å±€å¯¹è±¡
console.log(typeof bucketGet);  // 'function'

// æ£€æŸ¥thisç»“æ„
console.log(JSON.stringify(this));

// æµ‹è¯•ä¸åŒçš„è°ƒç”¨æ–¹å¼
try { method1(); } catch(e) { console.log(e); }
try { method2(); } catch(e) { console.log(e); }
```

## æˆæœäº¤ä»˜

**æœ€ç»ˆæ–‡ä»¶**: [è‚šå­ç–¼_v1.1.js](file:///Users/z.W./.gemini/antigravity/scratch/%E8%82%9A%E5%AD%90%E7%96%BC_v1.1.js)

**çŠ¶æ€**: âœ… å·²éªŒè¯å¯ç”¨

**åŠŸèƒ½**: å®Œæ•´å®ç°æ‰€æœ‰éœ€æ±‚
