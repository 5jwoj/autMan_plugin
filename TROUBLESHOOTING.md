# 插件无响应问题排查指南

## 问题现象

用户在 Telegram 发送"肚子疼"后，autMan 接收到了消息，但插件没有任何回复。

从日志可以看到：
```
[2026-01-09 20:11:52][DEBUG][/root/aut/core/function.go:281]接收到消息：-1
群号：()
用户：860665112(zha0w)[]
类型：tb
内容：肚子疼
```

## 可能的原因

### 1. 插件规则配置问题 ⭐ 最可能

**检查步骤**：
1. 登录 autMan 后台
2. 进入"知识库"或"插件管理"
3. 检查是否有"肚子疼"相关的规则
4. 确认规则配置：
   - 关键词：`肚子疼`
   - 匹配方式：完全匹配或包含匹配
   - 执行脚本：`肚子疼.js`
   - 是否启用：✅

**正确配置示例**：
```
规则关键词: 肚子疼
匹配方式: 完全匹配
执行脚本: 肚子疼.js
状态: 启用
```

### 2. 文件路径问题

**检查步骤**：
1. 确认文件是否在正确的目录：
   ```
   /root/aut/plugin/replies/肚子疼.js
   ```
2. 检查文件权限：
   ```bash
   ls -la /root/aut/plugin/replies/肚子疼.js
   chmod 644 /root/aut/plugin/replies/肚子疼.js
   ```

### 3. 文件编码问题

**检查步骤**：
1. 确认文件编码为 UTF-8：
   ```bash
   file /root/aut/plugin/replies/肚子疼.js
   ```
2. 如果不是 UTF-8，转换编码：
   ```bash
   iconv -f GBK -t UTF-8 肚子疼.js > 肚子疼_utf8.js
   mv 肚子疼_utf8.js 肚子疼.js
   ```

### 4. 语法错误

**检查步骤**：
1. 查看 autMan 日志是否有错误信息：
   ```bash
   tail -f /root/aut/logs/autman.log
   ```
2. 使用调试版本测试

### 5. autMan 授权问题

**检查步骤**：
1. 确认 autMan 授权（咖啡码）是否有效
2. 在后台查看授权状态
3. 注意：HTML 插件不需要授权，但 ES5 插件需要

## 排查步骤

### 第一步：使用调试版本

1. 将 `肚子疼-debug.js` 上传到 `/root/aut/plugin/replies/`
2. 在后台添加规则：
   - 关键词：`肚子疼测试`
   - 执行脚本：`肚子疼-debug.js`
3. 发送"肚子疼测试"，查看是否有响应

**预期结果**：
- 如果有响应：说明插件环境正常，问题在原插件代码
- 如果无响应：说明配置或环境有问题

### 第二步：检查日志

查看 autMan 日志中的错误信息：
```bash
tail -100 /root/aut/logs/autman.log | grep -i error
```

### 第三步：简化测试

创建一个最简单的测试插件 `test.js`：
```javascript
sendText("Hello from autMan!");
```

配置规则后发送关键词，如果这个都不响应，说明是配置问题。

### 第四步：检查规则优先级

如果有多个规则匹配同一个关键词，可能被其他规则拦截了：
1. 检查是否有其他规则包含"肚子疼"
2. 调整规则优先级
3. 使用更精确的匹配方式

## 常见解决方案

### 方案 1：重新配置规则

1. 删除现有的"肚子疼"规则
2. 重新添加规则：
   ```
   规则关键词: 肚子疼
   匹配方式: 完全匹配
   执行脚本: 肚子疼.js
   ```
3. 保存并测试

### 方案 2：重启 autMan

有时候需要重启 autMan 才能加载新的插件：
```bash
# 根据你的 autMan 启动方式选择
systemctl restart autman
# 或
./autman restart
```

### 方案 3：使用包含匹配

如果完全匹配不工作，尝试包含匹配：
```
规则关键词: 肚子疼
匹配方式: 包含匹配
执行脚本: 肚子疼.js
```

### 方案 4：检查文件名

确保文件名完全正确：
- ✅ 正确：`肚子疼.js`
- ❌ 错误：`肚子疼 .js`（有空格）
- ❌ 错误：`肚子疼.JS`（大小写）

## 调试命令

### 查看插件文件
```bash
cat /root/aut/plugin/replies/肚子疼.js
```

### 查看实时日志
```bash
tail -f /root/aut/logs/autman.log
```

### 测试文件语法
```bash
node -c /root/aut/plugin/replies/肚子疼.js
```

## 联系支持

如果以上方法都无法解决，请提供以下信息：
1. autMan 版本号
2. 完整的错误日志
3. 插件规则配置截图
4. 文件路径和权限信息

---

**提示**：最常见的问题是规则配置不正确或文件路径错误，请先检查这两项！
