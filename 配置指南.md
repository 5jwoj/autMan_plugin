# autMan 插件配置指南

## 🚨 重要：插件无响应的解决方法

根据你的日志显示，autMan 已经接收到消息，但插件没有响应。这是**插件规则配置问题**。

## 📋 配置步骤（必须按顺序执行）

### 步骤 1：上传插件文件

将 `肚子疼.js` 文件上传到 autMan 服务器：

```bash
# 方法1：使用 scp 上传
scp 肚子疼.js root@你的服务器IP:/root/aut/plugin/replies/

# 方法2：使用 SFTP 工具上传到
/root/aut/plugin/replies/肚子疼.js
```

### 步骤 2：检查文件权限

```bash
# SSH 登录服务器后执行
cd /root/aut/plugin/replies/
ls -la 肚子疼.js

# 如果权限不对，修改权限
chmod 644 肚子疼.js
```

### 步骤 3：配置插件规则

#### 方式 A：在 autMan 后台配置（推荐）

1. 打开 autMan Web 后台（通常是 `http://你的IP:端口`）
2. 进入 **"知识库"** 或 **"插件管理"** 页面
3. 点击 **"添加规则"** 或 **"新建"**
4. 填写以下信息：

```
规则名称: 肚子疼记录
规则关键词: 肚子疼
匹配方式: 完全匹配
执行脚本: 肚子疼.js
状态: 启用 ✅
```

5. 保存规则

#### 方式 B：直接修改配置文件

编辑 autMan 的知识库配置文件：

```bash
# 找到知识库配置文件（路径可能不同）
vi /root/aut/data/reply.json
```

添加以下规则：

```json
{
  "rules": ["肚子疼"],
  "content": "肚子疼.js"
}
```

### 步骤 4：重启 autMan（重要！）

配置完成后，必须重启 autMan 才能生效：

```bash
# 方法1：如果使用 systemd
systemctl restart autman

# 方法2：如果使用 supervisor
supervisorctl restart autman

# 方法3：如果是手动启动
# 先找到进程
ps aux | grep autman
# 杀掉进程
kill -9 <进程ID>
# 重新启动
cd /root/aut && ./autman
```

### 步骤 5：测试插件

重启后，在 Telegram 发送：`肚子疼`

**预期响应**：
```
📝 确认要记录一次肚子疼事件吗？

请输入：
  y - 确认
  n - 取消
  q - 退出
```

## 🔍 问题排查

### 如果还是没有响应

#### 1. 检查日志

```bash
# 实时查看日志
tail -f /root/aut/logs/autman.log

# 查看最近的错误
tail -100 /root/aut/logs/autman.log | grep -i error
```

#### 2. 使用调试版本

将 `肚子疼-debug.js` 上传到服务器，配置规则：

```
规则关键词: 测试
执行脚本: 肚子疼-debug.js
```

发送"测试"，如果有响应说明配置正确，问题在原插件代码。

#### 3. 检查规则是否生效

在 autMan 后台查看规则列表，确认：
- ✅ 规则已启用
- ✅ 关键词正确
- ✅ 脚本路径正确

#### 4. 检查是否被其他规则拦截

如果有其他规则也匹配"肚子疼"，可能被拦截了：
- 检查规则优先级
- 暂时禁用其他规则测试

## 📝 完整的规则配置示例

### 配置所有命令

需要添加 4 个规则：

#### 规则 1：记录
```
规则关键词: 肚子疼
匹配方式: 完全匹配
执行脚本: 肚子疼.js
```

#### 规则 2：查看记录
```
规则关键词: 肚子疼记录
匹配方式: 完全匹配
执行脚本: 肚子疼.js
```

#### 规则 3：删除记录
```
规则关键词: 肚子疼删除
匹配方式: 完全匹配
执行脚本: 肚子疼.js
```

#### 规则 4：帮助
```
规则关键词: 肚子疼帮助
匹配方式: 完全匹配
执行脚本: 肚子疼.js
```

### 或者使用一个规则（包含匹配）

```
规则关键词: 肚子疼
匹配方式: 包含匹配
执行脚本: 肚子疼.js
```

这样所有包含"肚子疼"的消息都会触发插件。

## ⚠️ 常见错误

### 错误 1：文件名不对
- ❌ `肚子疼 .js`（有空格）
- ❌ `肚子疼.JS`（大小写错误）
- ✅ `肚子疼.js`（正确）

### 错误 2：路径不对
- ❌ `/root/aut/plugin/肚子疼.js`
- ❌ `/root/aut/plugins/replies/肚子疼.js`
- ✅ `/root/aut/plugin/replies/肚子疼.js`

### 错误 3：没有重启
配置后必须重启 autMan！

### 错误 4：规则未启用
检查规则状态是否为"启用"。

## 💡 快速测试脚本

创建一个最简单的测试文件 `test.js`：

```javascript
sendText("✅ 插件配置成功！");
```

上传后配置规则：
```
规则关键词: 测试
执行脚本: test.js
```

发送"测试"，如果有响应说明配置流程正确。

## 📞 需要帮助？

如果按照以上步骤还是无法解决，请提供：
1. autMan 版本号
2. 完整的日志输出
3. 规则配置截图
4. 文件列表：`ls -la /root/aut/plugin/replies/`
