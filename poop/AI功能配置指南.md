# 便便记录插件 - AI 功能配置指南

## 📋 概述

便便记录插件 v1.4.0 新增了 AI 健康分析功能，使用智谱 AI 对您的便便记录进行智能分析，提供健康建议。

## 🚀 快速开始

### 1. 获取智谱 AI API 密钥

1. 访问 [智谱 AI 开放平台](https://open.bigmodel.cn/)
2. 注册/登录账号
3. 进入控制台，创建 API Key
4. 复制生成的 API Key（格式：`sk-xxxxxxxxxx`）

### 2. 在 autMan 中配置

1. 登录 autMan Web 管理界面
2. 进入 **插件管理** 页面
3. 找到 **便便记录** 插件
4. 点击 **配置** 按钮
5. 填写以下参数：

   - **智谱AI密钥** (必填)
     - 填入你的 API Key
     - 格式：`sk-xxxxxxxxxx`
   
   - **智谱AI模型** (可选)
     - 默认：`glm-4-flash` (推荐，速度快、成本低)
     - 可选：`glm-4`、`glm-4-plus` (更强大，但成本更高)
   
   - **AI分析提示词** (可选)
     - 留空使用默认提示词
     - 自定义提示词示例见下文

6. 保存配置

### 3. 使用 AI 分析

配置完成后，发送以下命令即可使用：

```
便便分析
```

## 🎨 自定义提示词

如果你想自定义 AI 分析的风格和内容，可以设置自定义提示词。

### 提示词变量

在自定义提示词中，可以使用 `{data}` 占位符，它会被替换为实际的便便数据摘要。

### 示例 1：简洁风格

```
你是一位健康顾问，请分析以下数据：

{data}

请给出简洁的健康建议，控制在150字以内。
```

### 示例 2：详细风格

```
你是一位专业的消化科医生，请根据以下便便记录数据进行详细的健康分析：

{data}

请提供：
1. 健康状况评估（正常/需注意/建议就医）
2. 具体分析（从频率、状态、规律性等方面）
3. 饮食建议
4. 生活习惯建议
5. 何时需要就医

要求：
- 语气专业但温和
- 控制在300字以内
- 给出实用的建议
```

### 示例 3：中医风格

```
你是一位中医养生专家，请根据以下便便记录从中医角度进行分析：

{data}

请从中医角度分析：
1. 体质判断
2. 可能的病因
3. 食疗建议
4. 穴位按摩建议

控制在200字以内。
```

## 📊 AI 分析内容

默认情况下，AI 分析会提供：

1. **健康状况评估**
   - 正常：便便频率和状态都在健康范围内
   - 需注意：有轻微异常，需要调整生活习惯
   - 建议就医：存在明显异常，建议咨询医生

2. **具体分析**
   - 频率分析：是否在正常范围（1-2次/天）
   - 状态分析：通畅、一般、费劲、拉稀的占比
   - 规律性分析：是否有明显的异常波动

3. **健康建议**
   - 饮食建议：多喝水、增加膳食纤维等
   - 作息建议：规律作息、适量运动等
   - 就医建议：何时需要咨询医生

## ⚙️ 模型选择建议

### glm-4-flash (推荐)
- **优点**：速度快、成本低、响应及时
- **缺点**：分析深度略浅
- **适用场景**：日常健康监测、快速反馈
- **成本**：约 0.0001 元/次

### glm-4
- **优点**：分析更全面、建议更详细
- **缺点**：速度稍慢、成本稍高
- **适用场景**：需要详细分析的情况
- **成本**：约 0.001 元/次

### glm-4-plus
- **优点**：最强大的分析能力、最专业的建议
- **缺点**：速度较慢、成本较高
- **适用场景**：有明显健康问题需要深度分析
- **成本**：约 0.01 元/次

## ⚠️ 注意事项

1. **隐私保护**
   - 所有数据仅用于分析，不会被存储或共享
   - 智谱 AI 遵守严格的隐私政策

2. **免责声明**
   - AI 分析仅供参考，不能替代专业医疗建议
   - 如有健康问题，请及时咨询专业医生
   - 不要仅凭 AI 分析结果自行诊断或用药

3. **成本控制**
   - 建议使用 glm-4-flash 模型（成本低）
   - 不要频繁调用分析功能
   - 建议每周分析 1-2 次即可

4. **API 额度**
   - 智谱 AI 新用户有免费额度
   - 超出免费额度后需要充值
   - 建议设置消费提醒

## 🔧 故障排查

### 问题 1：提示"AI分析功能未配置"

**解决方案**：
- 检查是否在插件管理中配置了智谱AI密钥
- 确认 API Key 格式正确（以 `sk-` 开头）

### 问题 2：提示"API密钥无效或已过期"

**解决方案**：
- 检查 API Key 是否正确
- 登录智谱 AI 平台确认 API Key 是否有效
- 检查 API Key 是否有足够的额度

### 问题 3：提示"网络连接问题"

**解决方案**：
- 检查服务器网络连接
- 确认可以访问 `open.bigmodel.cn`
- 检查防火墙设置

### 问题 4：提示"API调用额度不足"

**解决方案**：
- 登录智谱 AI 平台查看额度
- 充值或等待额度恢复
- 考虑使用成本更低的模型（glm-4-flash）

## 📞 技术支持

如有问题，请：
1. 查看 [智谱 AI 官方文档](https://open.bigmodel.cn/dev/api)
2. 查看插件 [GitHub 仓库](https://github.com/5jwoj/autMan_plugin)
3. 提交 Issue 或 Pull Request

## 📝 更新日志

### v1.4.0 (2026-02-06)
- ✨ 新增 AI 健康分析功能
- ✨ 支持配置智谱 AI 模型
- ✨ 支持自定义分析提示词
- 📝 更新文档和使用说明
