# autMan 便便记录插件

一个功能完整的 autMan 插件，用于记录和追踪便便事件，支持 AI 健康分析。

## ✨ 功能特性

- 📝 **记录便便事件** - 快速记录发生时间
- 💩 **便便过程选项** - 记录便便过程（A通畅 😊 / B一般 😐 / C费劲 😣 / D拉稀 💧）
- 📊 **美观的记录展示** - 按日期分组，颜色标记，统计分析
- 🗑️ **删除记录** - 支持选择性删除历史记录
- 🔒 **确认机制** - 记录和删除操作需要 y/n/q 确认
- 📈 **统计分析** - 自动计算频率、跨度等统计信息
- 🤖 **AI 健康分析** - 使用智谱 AI 分析便便健康状况（可选）

## 🎨 显示样式

```
📊 便便记录 (共3条)
━━━━━━━━━━━━━━━━━━━━━━━━━

🗓️ 1月9日 🟡
  └─ 12:20 - 通畅
  └─ 18:30 - 一般
  📊 当天2次

🗓️ 1月8日 🟢
  └─ 10:00 - 通畅
  📊 当天1次

━━━━━━━━━━━━━━━━━━━━━━━━━
📈 总体统计
• 记录时段: 2026-01-08 至 2026-01-09
• 记录天数: 2天 (跨度2天)
• 总计次数: 3次
• 平均频率: 1.50次/天
```

**颜色标记**：
- 🟢 1次/天
- 🟡 2次/天
- 🔴 3次及以上

## 🚀 快速开始

### 安装

1. 下载 `便便.py` 文件
2. 上传到 autMan 服务器：
   ```bash
   scp 便便.py root@服务器:/root/aut/plugin/scripts/
   ```
3. 设置权限：
   ```bash
   chmod 755 /root/aut/plugin/scripts/便便.py
   ```
4. 重启 autMan：
   ```bash
   systemctl restart autman
   ```

### 使用

- `便便` - 记录一次便便事件（需要确认）
- `便便记录` - 查看所有历史记录（直接显示）
- `便便删除` - 删除指定的历史记录（需要确认）
- `便便分析` - AI 分析便便健康状况（需配置智谱 AI）
- `便便帮助` - 显示帮助信息

## 🤖 AI 健康分析（可选）

### 配置智谱 AI

1. 访问 [智谱 AI 开放平台](https://open.bigmodel.cn/) 注册并获取 API 密钥
2. 在 autMan Web 管理界面的插件管理中配置以下参数：
   - **智谱AI密钥**：填入你的 API Key（格式：`sk-xxx`）
   - **智谱AI模型**（可选）：默认使用 `glm-4-flash`，可选 `glm-4`、`glm-4-plus` 等
   - **AI分析提示词**（可选）：自定义分析提示词，留空使用默认提示词

### 自定义提示词

如果你想自定义 AI 分析的提示词，可以在配置中设置。提示词中可以使用 `{data}` 占位符，它会被替换为实际的便便数据摘要。

示例自定义提示词：
```
你是一位专业的健康顾问，请分析以下数据：

{data}

请给出简洁的健康建议，控制在150字以内。
```

### AI 分析功能说明

- 分析基于最近 7 天的便便记录
- 提供健康状况评估、具体分析和健康建议
- 仅供参考，不能替代专业医疗建议
- 如有健康问题，请咨询专业医生

## 📋 版本信息

**当前版本**: v1.4.0

**更新内容**:
- v1.4.0: 添加 AI 健康分析功能，支持配置智谱 AI 模型和自定义提示词
- v1.3.0: 优化记录展示，添加统计分析
- v1.1.0: 添加便便过程选项（A通畅/B一般/C费劲/D拉稀）
- v1.0.0: 初始版本

## 🔧 技术说明

- **语言**: Python 3
- **方式**: middleware 中间件
- **规则**: `^便便(.*)$` - 在代码头部定义，无需后台配置
- **存储桶**: `poop`
- **存储**: JSON 格式，按用户 ID 存储
- **AI 集成**: 智谱 AI API（可选）

## 📄 许可证

MIT License
